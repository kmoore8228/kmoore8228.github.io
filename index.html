<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<div class="h1">Evolution of the NBA shot diet</div>
<div class="h2">Number of shots by range in the <span id ="season"></span> season</div>
<style>
    table.tooltip {
    background: white;
    border: 5px;
    border-color: black;
    position: absolute;
    width: 300px;
    height: 50px;
    font: 12px sans-serif;
    pointer-events: none;
}
th, td {
  border: 1px solid black;
}
h1 {
  font-size: 40px;
}
h2 {
  font-size: 25px;
}
</style>
<body onload='init()'>
<svg width="600" height="500"></svg>
<script>
async function init() {
    var season = "97-98";
    document.getElementById("season").innerHTML = season
    const leaders = await d3.csv("https://kmoore8228.github.io/"+season+"Leaders.csv");
    const aggregateData = await d3.csv("https://kmoore8228.github.io/"+season+".csv");

    var margin = 50
    var width = 1000
    var height = 1000
    var x = d3.scaleBand().rangeRound([0, width]).padding(0.1);
    var xAxis = d3.axisBottom(x).tickFormat(function (d) {
        var mapper = {
            "PaintFGA": "Paint FGA",
            "Mid-rangeFGA": "Mid-range FGA",
            "3PFGA": "3P FGA"
        }
        return mapper[d]
        });
    x.domain(aggregateData.map(function(d) { return d.stat; }));

    var y = d3.scaleLinear().domain([0,100000]).range([height,0]);

    var tooltip = d3.select("body").append("table")
        .attr("class", "tooltip")
        .style("opacity", 0);

    // String -> number
    aggregateData.forEach(function(d) {
        d.value = +d.value;
    });

    d3.select("svg")
        .attr("width", width + 2*margin)
        .attr("height", height + 2*margin)
        .append("g")
        .attr("transform", "translate("+margin+","+margin+")");

    d3.select("svg").append("g")
        .attr("transform", "translate("+margin+","+margin+")")
        .call(d3.axisLeft(y));
        
    d3.select("svg").append("g")
        .attr("transform", "translate("+margin+","+(height+margin)+")")
        .call(xAxis);

    var colors = ["green","red", "blue"]

    d3.select("svg").append("g")
        .selectAll("rect")
        .data(aggregateData)
        .enter().append("rect")
        .attr("x", function(d) { return margin + x.bandwidth()/4 + x(d.stat); })
        .attr("y", function(d) { return margin + y(d.value); })
        .attr("width", x.bandwidth()/2)
        .attr("height", function(d) { return height - y(d.value) })
        .attr("fill", function(d, i) { return colors[i] })
        .on("mouseover", function(d) {
            tooltip.transition()
                .duration(200)
                .style("opacity", 1);
            var newHtml = [];
            newHtml.push('<table><tr>',
                '<td>Player</td>',
                '<td>Made</td>',
                '<td>Attempted</td>',
                '<td>% Made</td>',
                '</tr>');
            leaders.forEach(function(l) {
                if (l.Zone == d.stat) {
                    newHtml.push('<tr>',
                        '<td>' + l.Player + '</td>',
                        '<td>' + l.FGM + '</td>',
                        '<td>' + l.FGA + '</td>',
                        '<td>' + l['FG%'] + '</td>',
                        '</tr>')
                }
            });
            newHtml.push('</table>');
            tooltip.html(newHtml.join(""));
            tooltip
                .style("left", d3.event.pageX + "px")
                .style("top", d3.event.pageY + "px")
        })
        .on("mouseout", function(d) {
            tooltip.transition()
                .duration(500)
                .style("opacity", 0)
        });
}
</script>
</body>
</html>